("function"===typeof requirejs&&"function"===typeof define&&define.amd instanceof Object?define:function(g,E){g=g();"object"===typeof process&&"object"===typeof process.versions&&"string"===typeof process.versions.node?module.exports=g:E.Histone=g})(function(){var g,E=function(a){var a=a.split("/"),b=""===a[0],d=[],e="";for(b&&a.shift();a.length;)e=a.shift(),".."===e?d.pop():"."!==e&&d.push(e);b&&d.unshift("");("."===e||".."===e)&&d.push("");return d.join("/")},S=function(a){return"string"===typeof a},T=function(a){a=a.match(bb);return{scheme:a[1]||"",authority:a[2]||"",path:a[3]||"",query:a[4]||"",fragment:a[5]||""}},ma=0,na=0,cb=/^(.*)\//,bb=/^(?:([^:\/?\#]+):)?(?:\/\/([^\/?\#]*))?([^?\#]*)(?:\?([^\#]*))?(?:\#(.*))?/;g={T_UNDEFINED:1,T_NULL:2,T_BOOLEAN:3,T_NUMBER:4,T_STRING:5,T_FUNCTION:6,T_ARRAY:7,T_OBJECT:8,isUndefined:function(a){return void 0===a},isNull:function(a){return null===a},isBoolean:function(a){return"boolean"===typeof a},isNumber:function(a){return"number"===typeof a},isString:S,isArray:function(a){return a instanceof Array},isObject:function(a){return a instanceof Object},isFunction:function(a){return a instanceof Function},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},isDOMElement:function(a){try{return a instanceof HTMLElement}catch(b){return"object"===typeof a&&1===a.nodeType}},getBaseType:function(a){if(null===a)return 2;if(a instanceof Array)return 7;switch(typeof a){case "undefined":return 1;case "boolean":return 3;case "number":return 4;case "string":return 5;case "function":return 6;case "object":return 8}},uniqueId:function(a){S(a)||(a="");var b=(new Date).getTime();b>ma?na=0:b+=++na;ma=b;return a+b.toString(36)+(1+Math.floor(32767*Math.random())).toString(36)+(1+Math.floor(32767*Math.random())).toString(36)},getEnvType:function(){return"undefined"!==typeof Packages?"rhino":"undefined"!==typeof process?"node":"undefined"!==typeof window?"browser":"unknown"},forEachAsync:function(a,b,d){a instanceof Object||d();var e,c,g,t,j=-1,f=0,h=!1;a instanceof Array?g=a.length:(e=Object.keys(a),g=e.length);t=g-1;var l=function(){f+=1;if(!h){for(h=!0;0<f;){f-=1;j+=1;if(j===g)return d();c=e?e[j]:j;b(a[c],function(a){!0===a?d():l()},c,j,t)}h=!1}};l()},uri:{parse:T,resolve:function(a,b,d){var a=T(a),b=T(b),e="",c="";if(a.scheme){e+=a.scheme+":";if(c=a.authority)e+="//"+c;if(c=E(a.path))e+=c;if(c=a.query)e+="?"+c}else{if(c=b.scheme)e+=c+":";if(c=a.authority){e+="//"+c;if(c=E(a.path||""))e+=c;if(c=a.query)e+="?"+c}else{if(c=b.authority)e+="//"+c;if(c=a.path){if(c=E("/"===c.charAt(0)?c:(b.authority&&!b.path?"/":(b.path.match(cb)||[""])[0])+c))e+=c;if(c=a.query)e+="?"+c}else{if(c=b.path)e+=c;if((c=a.query)||(c=b.query))e+="?"+c}}}d&&(e+=d);if(c=a.fragment)e+="#"+c;return e},parseQuery:function(a){var b={};if(!S(a))return{};for(var a=a.split("&"),d,e=a.length,c=0;c<e;c++)d=a[c].split("=",2),b[d[0]]=d[1];return b}}};var C,oa=-1,U=0,pa=2,qa=3,G=function(){function a(){if(h!==m)if(r=f[o],p=r[0].exec(j)){q=p.length;for(y=1;y<q;y++)if(F=p[y]){B=p.index;if(z=B-h)k=l.push({type:U,pos:h,value:j.substr(h,z)}),h+=z;z=F.length;h=B+z;s=r[1][y-1];switch(s[0]){case pa:k=l.push({type:s[1],pos:B,value:F});break;case qa:k=l.push({type:s[1],pos:B,len:z});break;default:a()}break}}else{if(z=m-h)k=l.push({type:U,pos:h,value:j.substr(h,z)}),h+=z}else k=l.push({type:oa,value:"EOF",pos:m})}function b(){k||a();k--;u=l.shift();n=u.type;if(c.hasOwnProperty(n)){var b=c[n];o!==b&&(f[b][0].lastIndex=f[o][0].lastIndex,o=b)}}function d(a,b,d){"object"!==typeof a&&(a=[a]);void 0===d&&(d=0);g[d]||(g[d]=[]);f[d]||(f[d]=[[],[]]);e++;g[d].push("("+a.join("|")+")");f[d][1].push([b,e]);return e}var e=0,c={},g={},f={},j,m,h,l,k,u,n,o,p,q,y,B,F,z,r,s;this.addToken=function(a,b){return d(a,pa,b)};this.addLiteral=function(a,b){return d(a,qa,b)};this.addIgnore=function(a,b){return d(a,1,b)};this.tokenize=function(a,d){h=0;l=[];k=0;n=u=null;j=a;m=a.length;void 0===d&&(d=0);o=d;for(d in f)f[d][0]=RegExp(g[d].join("|"),"g");b()};this.addTransition=function(a,b){void 0===b&&(b=0);c[a]=b};this.getLineNumber=function(){for(var a=-1,b=1,d,e=u.pos;++a<e;)d=j.charCodeAt(a),(10===d||13===d)&&b++;return b};this.getFragment=function(){return u.value?u.value:j.substr(u.pos,u.len)};this.test=function(a){return u.type===a};this.next=function(a){if(void 0===a||this.test(a))return a=u,b(),a}};G.T_EOF=oa;G.T_FRAGMENT=U;C=G;var h,sa=function(a){a=a.slice(1,-1);return a.replace(ra||(ra=RegExp("\\\\(t|b|n|r|f|'|\"|\\\\|\\x[0-9A-F]{2}|\\u[0-9A-F]{4})","g")),function(a,d){switch(d[0]){case "'":return"'";case '"':return'"';case "\\":return"\\";case "b":return String.fromCharCode(8);case "t":return String.fromCharCode(9);case "n":return String.fromCharCode(10);case "f":return String.fromCharCode(12);case "r":return String.fromCharCode(13);case "u":return String.fromCharCode(parseInt(d.substr(1),16));case "x":return String.fromCharCode(parseInt(d.substr(1),16))}})},c,ra,V,M,W,N,X,n,ta,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,Y,Ea,Z,$,H,aa,Fa,ba,ca,Ga,Ha,Ia,Ja,Ka,La,Ma,da,J,K,v,Na,Oa,O,L,Pa,ea,fa,Qa,p,ga,w,f=function(){function a(a,b){var b=b||c.getFragment(),d=c.getLineNumber(),e=y+"("+d+') Syntax error, "'+a+'" expected, but "'+b+'" found';return{file:y,line:d,expected:a,found:b,toString:function(){return e}}}function b(){if(c.next(ya))return[f.T_NULL];if(c.next(Ca))return[f.T_TRUE];if(c.next(Da))return[f.T_FALSE];if(c.test(Ha)){var b=c.next(),b=parseInt(b.value,10);return[f.T_INT,b]}if(c.test(Ga))return b=c.next(),b=parseFloat(b.value,10),[f.T_DOUBLE,b];if(c.test(ga))return b=c.next(),b=sa(b.value),[f.T_STRING,b];if(c.next(da)){var b=[],d,e;if(!c.test(J))for(;;){d=null;e=m();if(c.next(O)){if(e[0]!==f.T_STRING&&e[0]!==f.T_INT&&(e[0]!==f.T_SELECTOR||1!==e[1].length))throw new a("identifier, string, number");d=e[0]!==f.T_SELECTOR?""+e[1]:""+e[1][0];e=m()}b.push([d,e]);if(!c.next(L))break}if(!c.next(J))throw new a("]");return[f.T_MAP,b]}if(c.test(w))return b=c.next(),[f.T_SELECTOR,[b.value]];if(c.next(za))return[f.T_SELECTOR,["this"]];if(c.next(Aa))return[f.T_SELECTOR,["self"]];if(c.next(Ba))return[f.T_SELECTOR,["global"]];if(c.next(K)){if(c.next(v))throw new a("expression","()");try{b=m()}finally{if(!c.next(v))throw new a(")");}return b}throw new a("expression");}function d(){var e;if(!(e=c.next(wa)&&[f.T_NOT,d()])){c.next(ea);for(e=c.next(fa)?[f.T_NEGATE,b()]:b();;)if(c.next(Pa)){if(!c.test(w))throw new a("identifier");e[0]!==f.T_SELECTOR&&(e=[f.T_SELECTOR,[e]]);e[1].push(c.next().value)}else if(c.next(da)){if(c.next(J))throw new a("expression","[]");e[0]!==f.T_SELECTOR&&(e=[f.T_SELECTOR,[e]]);e[1].push(m());if(!c.next(J))throw new a("]");}else if(e[0]===f.T_SELECTOR&&c.next(K)){var g=null,i;if(!c.next(v)){for(g=[];!(g.push(m()),!c.next(L)););if(!c.next(v))throw new a(")");}i=e[1].pop();e=[f.T_CALL,e[1].length?e:null,i,g]}else break}return e}function e(){for(var a=d();c.next(Qa)&&(a=[f.T_MUL,a,d()])||c.next(p)&&(a=[f.T_DIV,a,d()])||c.next(xa)&&(a=[f.T_MOD,a,d()]););return a}function g(){for(var a=e();c.next(ea)&&(a=[f.T_ADD,a,e()])||c.next(fa)&&(a=[f.T_SUB,a,e()]););return a}function i(){var a=g();return c.next(Ja)&&[f.T_LESS_OR_EQUAL,a,g()]||c.next(La)&&[f.T_LESS_THAN,a,g()]||c.next(Ka)&&[f.T_GREATER_OR_EQUAL,a,g()]||c.next(Ma)&&[f.T_GREATER_THAN,a,g()]||a}function t(){for(var a=i();c.next(ta)&&(a=[f.T_EQUAL,a,i()])||c.next(Ia)&&(a=[f.T_NOT_EQUAL,a,i()]););return a}function j(){for(var a=t();c.next(va)&&(a=[f.T_AND,a,t()]););return a}function m(){var a;for(a=j();c.next(ua)&&(a=[f.T_OR,a,j()]););for(;c.next(Na);)a=[f.T_TERNARY,a,m()],c.next(O)&&a.push(m());return a}function h(){if(c.next(ba)){var b=c.next(w);if(!b)throw new a("identifier");var d;if(c.next(Oa)){if(d=m(),!c.next(n))throw new a("}}");}else{if(!c.next(n))throw new a("}}");d=[f.T_STATEMENTS,x(p)];if(!c.next(p)||!c.next(ba)||!c.next(n))throw new a("{{/var}}");}return[f.T_VAR,b.value,d]}}function l(){if(c.next(Z)){for(var b=[],d,e;;){d=m();if(!c.next(n))throw new a("}}");e=x(p,H,$);b.push([d,e]);if(!c.next($))break}if(c.next(H)){if(!c.next(n))throw new a("}}");e=x(p);b.push([[f.T_TRUE],e])}if(!c.next(p)||!c.next(Z)||!c.next(n))throw new a("{{/if}}");return[f.T_IF,b]}}function k(){if(c.next(aa)){var b=c.next(w);if(!b)throw new a("identifier");b=[b.value];if(c.next(O)){var d=c.next(w);if(!d)throw new a("identifier");b.unshift(d.value)}if(!c.next(Fa))throw new a("in");d=m();if(!c.next(n))throw new a("}}");var e=[x(p,H)];if(c.next(H)){if(!c.next(n))throw new a("}}");e.push(x(p))}if(!c.next(p)||!c.next(aa)||!c.next(n))throw new a("{{/for}}");return[f.T_FOR,b,d,e]}}function o(){if(c.next(ca)){var b=c.next(w);if(!b)throw new a("identifier");var d=[];if(c.next(K)&&!c.next(v)){for(;;){var e=c.next(w);if(!e)throw new a("identifier");d.push(e.value);if(!c.next(L))break}if(!c.next(v))throw new a(")");}if(!c.next(n))throw new a("}}");e=x(p);if(!c.next(p)||!c.next(ca)||!c.next(n))throw new a("{{/macro}}");return[f.T_MACRO,b.value,d,e]}}function q(){if(c.next(Y)){var b=c.next(w);if(!b)throw new a("identifier");var d=[];if(c.next(K)&&!c.next(v)){for(;!(d.push(m()),!c.next(L)););if(!c.next(v))throw new a(")");}if(!c.next(n))throw new a("}}");d.push([f.T_STATEMENTS,x(p)]);if(!c.next(p)||!c.next(Y)||!c.next(n))throw new a("{{/call}}");return[f.T_CALL,null,b.value,d]}}function s(){if(c.next(Ea)){var b=c.next(ga);if(!b)throw new a("string");b=sa(b.value);if(!c.next(n))throw new a("}}");return[f.T_IMPORT,b]}}function r(){var b=m();if(!c.next(n))throw new a("}}");return b}function x(){for(var b=[];!c.next(C.T_EOF);){for(;c.next(V);){for(;!c.test(M)&&!c.next(C.T_EOF);)c.next();if(!c.next(M))throw new a("*}}");}for(;c.next(W);){for(var d="";!c.test(N)&&!c.next(C.T_EOF);)d+=c.next().value;if(!c.next(N))throw new a("%}}");b.push(d)}if(c.next(X)){if(d=Array.prototype.slice.call(arguments)){for(var e=!1;d.length;)if(c.test(d.shift())){e=!0;break}if(e)break}c.next(n)||b.push(l()||k()||h()||o()||q()||s()||r())}else c.test(C.T_FRAGMENT)&&b.push(c.next().value)}return b}var y;this.parse=function(a,b){y=b||"template";c||(c=new C,V=c.addLiteral("{{\\*",
0),M=c.addLiteral("\\*}}",2),W=c.addLiteral("{{%",0),N=c.addLiteral("%}}",3),X=c.addLiteral("{{",0),n=c.addLiteral("}}",1),ta=c.addLiteral("is\\b",1),ua=c.addLiteral("or\\b",1),va=c.addLiteral("and\\b",1),wa=c.addLiteral("not\\b",1),xa=c.addLiteral("mod\\b",1),za=c.addLiteral("this\\b",1),Aa=c.addLiteral("self\\b",1),Ba=c.addLiteral("global\\b",1),ya=c.addLiteral("null\\b",1),Ca=c.addLiteral("true\\b",1),Da=c.addLiteral("false\\b",1),Y=c.addLiteral("call\\b",1),Ea=c.addLiteral("import\\b",1),Z=c.addLiteral("if\\b",1),$=c.addLiteral("elseif\\b",1),H=c.addLiteral("else\\b",1),aa=c.addLiteral("for\\b",1),Fa=c.addLiteral("in\\b",1),ba=c.addLiteral("var\\b",1),ca=c.addLiteral("macro\\b",1),Ga=c.addToken(["(?:[0-9]*\\.)?[0-9]+[eE][\\+\\-]?[0-9]+","[0-9]*\\.[0-9]+"],1),Ha=c.addToken("[0-9]+",1),Ia=c.addLiteral("isNot\\b",1),Ja=c.addLiteral("<=",1),Ka=c.addLiteral(">=",1),La=c.addLiteral("<",1),Ma=c.addLiteral(">",1),da=c.addLiteral("\\[",1),J=c.addLiteral("\\]",1),K=c.addLiteral("\\(",1),v=c.addLiteral("\\)",1),Na=c.addLiteral("\\?",1),Oa=c.addLiteral("=",1),O=c.addLiteral(":",1),L=c.addLiteral(",",1),Pa=c.addLiteral("\\.",1),ea=c.addLiteral("\\+",1),fa=c.addLiteral("\\-",1),Qa=c.addLiteral("\\*",1),p=c.addLiteral("\\/",1),ga=c.addToken(["'(?:[^'\\\\]|\\\\.)*'",'"(?:[^"\\\\]|\\\\.)*"'],1),w=c.addToken("[a-zA-Z_$][a-zA-Z0-9_$]*",1),c.addIgnore("[\t\n\r ]+",1),c.addTransition(V,2),c.addTransition(M,0),c.addTransition(W,3),c.addTransition(N,0),c.addTransition(X,1),c.addTransition(n,0));c.tokenize(a,0);return x()}};f.T_OR=1;f.T_AND=2;f.T_EQUAL=3;f.T_NOT_EQUAL=4;f.T_LESS_OR_EQUAL=5;f.T_LESS_THAN=6;f.T_GREATER_OR_EQUAL=7;f.T_GREATER_THAN=8;f.T_ADD=9;f.T_SUB=10;f.T_MUL=11;f.T_DIV=12;f.T_MOD=13;f.T_NEGATE=14;f.T_NOT=15;f.T_TRUE=16;f.T_FALSE=17;f.T_NULL=100;f.T_INT=101;f.T_DOUBLE=102;f.T_STRING=103;f.T_TERNARY=104;f.T_SELECTOR=105;f.T_CALL=106;f.T_MAP=107;f.T_STATEMENTS=109;f.T_IMPORT=110;f.T_IF=1E3;f.T_VAR=1001;f.T_FOR=1002;f.T_MACRO=1003;h=f;var r=function(a){this.baseURI="";this.vars=[{}];this.macros=[{}];this.stackPointer=0;this.context=a};r.prototype.setBaseURI=function(a){this.baseURI=a};r.prototype.getBaseURI=function(){return this.baseURI};r.prototype.putVar=function(a,b){this.vars[this.stackPointer][a]=b};r.prototype.getVar=function(a,b){var d=this.vars,e,c=this.stackPointer;do if(e=d[c],e.hasOwnProperty(a))return b(e[a],!0);while(c--);b()};r.prototype.putMacro=function(a,b,d,e){this.macros[this.stackPointer][a]=[b,d,e]};r.prototype.getMacro=function(a){var b=this.macros,d,e=this.stackPointer;do if(d=b[e],d.hasOwnProperty(a))return d[a];while(e--)};r.prototype.save=function(){this.vars.push({});this.macros.push({});this.stackPointer++};r.prototype.restore=function(){this.vars.pop();this.macros.pop();this.stackPointer--};var o,P=function(a,b,d){if(Array.prototype.indexOf)return a.indexOf(b,d);void 0===d&&(d=0);0>d&&(d+=a.length);0>d&&(d=0);for(var e=a.length;d<e;d++)if(d in a&&a[d]===b)return d;return-1},Ra=function(){var a=-1,b=[],d=[];this.concat=function(e){if(!(e instanceof this.constructor))return this;a=0;for(var c=[],i=[],f=e.keys(),e=e.values(),j=0;j<d.length;j++){var h=b[j];g.isNumeric(h)?c.push(a++):c.push(h);i.push(d[j])}for(j=0;j<e.length;j++)h=f[j],g.isNumeric(h)?c.push(a++):c.push(h),i.push(e[j]);a--;b=c;d=i;return this};this.length=function(){return d.length};this.keys=function(){return b};this.values=function(){return d};this.hasKey=function(a){return!g.isString(a)&&!g.isNumber(a)?!1:-1!==P(b,""+a)};this.join=function(a){g.isString(a)||(a="");return d.join(a)};this.get=function(a){if(g.isString(a)||g.isNumber(a))return a=P(b,""+a),-1===a?void 0:d[a]};this.set=function(e,c){if(g.isString(e)||g.isNumber(e)){var e=""+e,i=P(b,e);-1===i?(g.isNumeric(e)&&e>a&&(a=parseInt(e)),b.push(e),d.push(c)):d[i]=c}else e=""+ ++a,b.push(e),d.push(c);return this};this.remove=function(a){if(!g.isString(a)&&!g.isNumber(a))return this;a=P(b,""+a);if(-1===a)return this;b.splice(a,1);d.splice(a,1);return this};this.clone=function(){var a,c,g,f=b.length,j=new Ra;for(g=0;g<f;g++)a=b[g],c=d[g],j.set(a,c);return j};this.slice=function(a,c){var i=d.length;g.isNumber(a)||(a=0);0>a&&(a=i+a);0>a&&(a=0);if(a>=i)return b=[],d=[],this;g.isNumber(c)||(c=0);0===c&&(c=i-a);0>c&&(c=i-a+c);if(0>=c)return b=[],d=[],this;b=b.slice(a,a+c);d=d.slice(a,a+c);return this};this.toObject=function(){var a,c=b.length,i,f,j=0,h=!0;for(i=0;i<c;i++){f=b[i];if(!g.isNumeric(f)||j!==parseInt(f)){h=!1;break}j++}a=h?[]:{};for(i=0;i<c;i++)j=d[i],j instanceof this.constructor&&(j=j.toObject()),h?a.push(j):(f=b[i],a[f]=j);return a}};o=Ra;var Sa=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],G=function(a,b,d,e,c){if(c){var i=[],a=g.uri.parse(a),e=g.uri.parseQuery(a.query),f=g.uniqueId("callback");e.callback=f;for(var j in e)e.hasOwnProperty(j)&&i.push(j+"="+e[j]);a=(a.scheme?a.scheme+"://":"")+(a.authority?a.authority:"")+(a.path?a.path:"")+(i.length?"?"+i.join("&"):"")+(a.fragment?"#"+a.fragment:"");window[f]=b;i=document.createElement("script");i.setAttribute("id",f);i.setAttribute("src",a);i.setAttribute("type","text/javascript");document.getElementsByTagName("head")[0].appendChild(i)}else{j=e;for(var h,e=!1,c=0;c<Sa.length;c++){try{e=Sa[c]()}catch(l){continue}break}if(h=e){g.isObject(j)||(j={});var c=j.hasOwnProperty("method")&&g.isString(j.method)&&j.method||"GET",k=j.hasOwnProperty("headers")&&g.isObject(j.headers)&&j.headers||{},e=null;j.hasOwnProperty("data")&&!g.isUndefined(j.data)&&(e=j.data,g.isObject(e)||(e=""+e));try{h.open(c,a,!0);for(f in k)k.hasOwnProperty(f)&&h.setRequestHeader(f,k[f]);h.onreadystatechange=function(){if(4===h.readyState){var a=h.status;if(399<a&&600>a)return d();a=h.getResponseHeader("Content-type");b(h.responseText,a)}};if(g.isObject(e)){a=[];for(i in e)e.hasOwnProperty(i)&&a.push(i+"="+encodeURIComponent(e[i]));e=a.join("&");h.setRequestHeader("Content-type","application/x-www-form-urlencoded")}h.send(e)}catch(o){d()}}else d()}},Ta,db=function(a,b,d,e,c,i){if(300<i.statusCode&&400>i.statusCode&&i.headers.location)return i=g.uri.parse(i.headers.location),i.authority||(i.authority=a.authority),Ua((i.scheme?i.scheme+"://":"")+(i.authority?i.authority:"")+(i.path?i.path:"")+(i.query?"?"+i.query:"")+(i.fragment?"#"+i.fragment:""),b,d,e,c);var f="";i.on("end",function(){b(f)});i.on("data",function(a){f+=a})},eb=function(a,b,d,e,c){var i="",f=a.query;g.isObject(e)||(e={});c&&(f&&(f+="&"),f=f+"callback="+g.uniqueId("callback"));f&&(f="?"+f);f={host:a.authority,path:a.path+f,method:e.hasOwnProperty("method")&&g.isString(e.method)&&e.method||"GET",headers:e.hasOwnProperty("headers")&&g.isObject(e.headers)&&e.headers||{}};if(e.hasOwnProperty("data")&&!g.isUndefined(e.data))if(i=e.data,g.isObject(i)){var h=[],m;for(m in i)i.hasOwnProperty(m)&&h.push(m+"="+encodeURIComponent(i[m]));i=h.join("&");f.headers["Content-type"]="application/x-www-form-urlencoded"}else i=""+i;m=("http"===a.scheme&&(Va=Va||require("http"))||"https"===a.scheme&&(Wa=Wa||require("https"))).request(f,Function.prototype.bind.apply(db,Array.prototype.concat.apply(this,arguments)));m.on("error",function(){d()});m.write(i);m.end()},Ua=function(a,b,d,e,c){var f=g.uri.parse(a);try{"http"===f.scheme||"https"===f.scheme?eb(f,b,d,e,c):""===f.scheme?(ha=ha||require("fs"),ha.readFile(a,function(a,e){if(a)return d();b(e.toString())})):d()}catch(h){d()}},ha=null,Va=null,Wa=null;Ta=Ua;var fb=function(a,b,d){var e=g.uri.parse(a);try{if("http"===e.scheme||"https"===e.scheme){var c=readUrl(a);b(c,a)}else""===e.scheme?(c=readFile(a),b(c,a)):d()}catch(f){d()}},s=function(a){switch(g.getBaseType(a)){case g.T_BOOLEAN:return a;case g.T_NUMBER:return 0!==a;case g.T_STRING:return 0<a.length;case g.T_OBJECT:return a instanceof o;default:return!1}},A=function(a){switch(g.getBaseType(a)){case g.T_UNDEFINED:return"";case g.T_NULL:case g.T_STRING:case g.T_BOOLEAN:return""+a;case g.T_NUMBER:a=(""+a).toLowerCase();if(-1===a.indexOf("e"))return a;var a=a.split("e"),b=a[0],d=a[1],a=b[0],e=d[0];"+"===a||"-"===a?b=b.substr(1):a="";"+"===e||"-"===e?d=d.substr(1):e="+";var c,f;c=b.indexOf(".");-1===c?(f=0,c=b.length):(f=b.substr(c+1).length,c=b.substr(0,c).length,b=b.replace(/\./g,""));c=d-c;"+"===e&&(c=d-f);f="";for(d=0;d<c;d++)f+="0";return"+"===e?a+b+f:a+"0."+f+b}if(g.isObject(a)&&a instanceof o){b=[];e=a.values();for(d=0;d<e.length;d++)a=e[d],g.isUndefined(a)||b.push(A(a));return b.join(" ")}return""},Q=function(a,b,d,e,c){try{if(g.isFunction(ia)&&!0===ia(a,b,function(b,e){g.isString(e)||(e=a);d(b,e)},e))return}catch(f){}var h=g.uri.resolve(a,b);ja.hasOwnProperty(h)?d(ja[h],h):Xa(h,function(a){a=d(a,h);g.isUndefined(a)||(ja[h]=a)},function(){d(void 0,h)},e,c)},q=function(a){if(!g.isFunction(a)){if(!g.isObject(a)||a instanceof o)return a;var b=new o,d;for(d in a)Object.prototype.hasOwnProperty.call(a,d)&&b.set(d,q(a[d]));return b}},ka=function(a){if(g.isObject(a)){if(a instanceof o)return a.toObject();for(var b in a)a[b]=ka(a[b])}return a},Ya=function(a,b,d){var e=a;switch(g.getBaseType(a)){case g.T_NULL:e=k.Type;break;case g.T_BOOLEAN:e=k.Type;break;case g.T_UNDEFINED:e=k.Type;break;case g.T_NUMBER:e=k.Number;break;case g.T_STRING:e=k.String}g.isObject(a)&&a instanceof o&&(e=k.Map);if(Object.prototype.hasOwnProperty.call(e,b))return e[b];if(k.Type.hasOwnProperty(b))return k.Type[b];if(d&&e.hasOwnProperty(""))return e[""]},I=function(a,b,d,e){var c,f;g.forEachAsync(b,function(b,e){l(b,d,function(b){c=a;if(f=Ya(a,b,!0))if(g.isFunction(f))try{f.call(d,c,[b],function(b){a=q(b);e()})}catch(h){a=void 0,e()}else a=q(f),e();else return a=void 0,e(!0)})},function(){e(a)})},Za=function(a,b,d,e){var c=a[0],g=a[1],a=a[2],f=d.getBaseURI(),h={arguments:b};d.save();d.setBaseURI(a);d.putVar("self",q(h));a=0;for(h=Math.min(b.length,c.length);a<h;a++)d.putVar(c[a],q(b[a]));return D(g,d,function(a){d.setBaseURI(f);d.restore();e(a)})},l=function(a,b,d){if(!g.isArray(a))return d(a);
var e=a[0];switch(e){case h.T_INT:case h.T_STRING:case h.T_DOUBLE:d(a[1]);break;case h.T_SELECTOR:var a=a[1],c,f=a.slice(1),t=a[0];g.isString(t)?"global"===t?I(k.Global,f,b,d):"this"===t?I(b.context,f,b,d):b.getVar(t,function(a,e){if(e)return I(a,f,b,d);if(k.Global.hasOwnProperty(t))return I(k.Global,[t].concat(f),b,d);c=b.context;if(g.isObject(c)&&c instanceof o&&c.hasKey(t))return I(c,[t].concat(f),b,d);I(void 0,f,b,d)}):l(t,b,function(a){I(a,f,b,d)});break;case h.T_VAR:var j=a[1],a=a[2];b.save();l(a,b,function(a){b.restore();b.putVar(j,a);d("")});break;case h.T_IF:var m="";g.forEachAsync(a[1],function(a,d){l(a[0],b,function(e){if(!s(e))return d();b.save();D(a[1],b,function(a){m=a;b.restore();d(!0)})})},function(){d(m)});break;case h.T_CALL:var n=a[1],p=a[3];l(a[2],b,function(a){var e=[];g.isArray(p)||(p=[]);g.forEachAsync(p,function(a,d){l(a,b,function(a){e.push(a);d()})},function(){var c=null;if(g.isNull(n)){if(c=b.getMacro(a))return Za(c,e,b,d);n=k.Global}l(n,b,function(f){if(c=Ya(f,a))if(g.isFunction(c))try{c.call(b,f,ka(e),function(a){d(q(a))})}catch(h){d()}else d(q(c));else return d()})})});break;case h.T_TERNARY:var r=a[2],u=a[3];l(a[1],b,function(a){s(a)?l(r,b,d):u?l(u,b,d):d()});break;case h.T_IMPORT:var a=a[1],v=b.getBaseURI();b.imports||(b.imports={});var w=a+"#"+v;b.imports.hasOwnProperty(w)?d():(b.imports[w]=!0,Q(a,v,function(a,e){try{return a=k(a,e),b.setBaseURI(e),D(a.getAST(),b,function(){b.setBaseURI(v);d("")}),a}catch(c){d()}}));break;case h.T_EQUAL:case h.T_NOT_EQUAL:var C=a[2];l(a[1],b,function(a){l(C,b,function(b){g.isString(a)&&g.isNumber(b)?g.isNumeric(a)?b=A(b):a=parseFloat(a,10):g.isNumber(a)&&g.isString(b)&&(g.isNumeric(b)?a=A(a):b=parseFloat(b,10));if(!g.isString(a)||!g.isString(b))g.isNumber(a)&&g.isNumber(b)?(a=parseFloat(a),b=parseFloat(b)):(a=s(a),b=s(b));b=a===b;d(e===h.T_EQUAL?b:!b)})});break;case h.T_STATEMENTS:D(a[1],b,d);break;case h.T_MACRO:b.putMacro(a[1],a[2],a[3],b.getBaseURI());d("");break;case h.T_MAP:var a=a[1],x=new o;g.forEachAsync(a,function(a,d){l(a[1],b,function(b){x.set(a[0],b);d()})},function(){d(x)});break;case h.T_ADD:var y=a[2];l(a[1],b,function(a){l(y,b,function(b){if(!g.isString(a)&&!g.isString(b)){if(g.isNumber(a)||g.isNumber(b)){g.isNumeric(a)&&(a=parseFloat(a,10));if(!g.isNumber(a))return d();g.isNumeric(b)&&(b=parseFloat(b,10));return!g.isNumber(b)?d():d(a+b)}if(a instanceof o&&b instanceof o){var e=a.clone(),e=e.concat(b);return d(e)}}a=A(a);b=A(b);d(a+b)})});break;case h.T_FOR:var B=a[1],F=a[3];l(a[2],b,function(a){if(a instanceof o&&a.length()){var e="",c,f=a.keys(),a=a.values();g.forEachAsync(a,function(a,d,g,h,i){b.save();b.putVar(B[0],q(a));B[1]&&b.putVar(B[1],f[h]);c={last:i,index:h};b.putVar("self",q(c));D(F[0],b,function(a){e+=a;b.restore();d()})},function(){d(e)})}else F[1]?(b.save(),D(F[1],b,function(a){b.restore();d(a)})):d("")});break;case h.T_TRUE:d(!0);break;case h.T_FALSE:d(!1);break;case h.T_OR:var z=a[2];l(a[1],b,function(a){s(a)?d(a):l(z,b,d)});break;case h.T_AND:var E=a[2];l(a[1],b,function(a){s(a)?l(E,b,d):d(a)});break;case h.T_NULL:d(null);break;case h.T_NOT:l(a[1],b,function(a){d(!s(a))});break;case h.T_SUB:case h.T_MUL:case h.T_DIV:case h.T_MOD:case h.T_NEGATE:var G=a[2];l(a[1],b,function(a){g.isNumeric(a)&&(a=parseFloat(a,10));if(!g.isNumber(a))return d();if(e===h.T_NEGATE)return d(-a);l(G,b,function(b){g.isNumeric(b)&&(b=parseFloat(b,10));if(!g.isNumber(b))return d();switch(e){case h.T_SUB:d(a-b);break;case h.T_MUL:d(a*b);break;case h.T_DIV:d(a/b);break;case h.T_MOD:d(a%b)}})});break;case h.T_LESS_THAN:case h.T_GREATER_THAN:case h.T_LESS_OR_EQUAL:case h.T_GREATER_OR_EQUAL:var H=a[2];l(a[1],b,function(a){l(H,b,function(b){g.isString(a)&&g.isNumber(b)?g.isNumeric(a)?a=parseFloat(a,10):b=A(b):g.isNumber(a)&&g.isString(b)&&(g.isNumeric(b)?b=parseFloat(b,10):a=A(a));if(!g.isNumber(a)||!g.isNumber(b))g.isString(a)&&g.isString(b)?(a=a.length,b=b.length):(a=s(a),b=s(b));switch(e){case h.T_LESS_THAN:d(a<b);break;case h.T_GREATER_THAN:d(a>b);break;case h.T_LESS_OR_EQUAL:d(a<=b);break;case h.T_GREATER_OR_EQUAL:d(a>=b)}})});break;default:throw d(),'unsupported template instruction "'+A(a)+'"';}},D=function(a,b,d){var e="";g.forEachAsync(a,function(a,d){g.isArray(a)?l(a,b,function(a){e+=A(a);d()}):(e+=a,d())},function(){d(e)})},$a=function(a,b){g.isString(b)||(b=".");this.getAST=function(){return a};this.render=function(d,e){var e=q(e),c=new r(e);c.setBaseURI(b);D(a,c,d)};this.call=function(d,e,c,g){var f=new r(g),g=q(g);f.setBaseURI(b);D(a,f,function(){var a=f.getMacro(d);if(!a)return c();Za(a,e,f,function(a){c(ka(a))})})}},ja={},ia=null,la=null,R=g.getEnvType(),ab="javascript/"+R,gb="javascript/browser"===ab?window.navigator.userAgent:"",Xa="node"===R&&Ta||"rhino"===R&&fb||"browser"===R&&G,k=function(a,b){if(g.isString(a))la||(la=new h),a=la.parse(a,b);else{if(a instanceof $a)return a;if(g.isDOMElement(a))return k(a.text||a.textContent,b);if(!g.isArray(a))throw'"'+a+'" is not a string';}return new $a(a,b)};k.OrderedMap=o;k.Type={isUndefined:function(a,b,d){d(g.isUndefined(a))},isNull:function(a,b,d){d(g.isNull(a))},isBoolean:function(a,b,d){d(g.isBoolean(a))},isNumber:function(a,b,d){d(g.isNumber(a))},isString:function(a,b,d){d(g.isString(a))},isMap:function(a,b,d){d(g.isObject(a)&&a instanceof o)},toJSON:function(a,b,d){if(g.isUndefined(a))return d("null");d(JSON.stringify(a))},toMap:function(a,b,d){if(a instanceof o)return d(a);d((new o).set(null,a))},toString:function(a,b,d){d(A(a))},toBoolean:function(a,b,d){d(s(a))}};k.Number={isInteger:function(a,b,d){d(0===a%1)},isFloat:function(a,b,d){d(0!==a%1)},toChar:function(a,b,d){d(String.fromCharCode(a))},toFixed:function(a,b,d){b=b[0];g.isNumber(b)&&0<=b?(b=Math.pow(10,b||0),d(Math.round(a*b)/b)):d(a)},abs:function(a,b,d){d(Math.abs(a))},floor:function(a,b,d){d(Math.floor(a))},ceil:function(a,b,d){d(Math.ceil(a))},round:function(a,b,d){d(Math.round(a))},pow:function(a,b,d){b=b[0];if(!g.isNumber(b))return d();a=Math.pow(a,b);if(isNaN(a))return d();d(a)},log:function(a,b,d){if(0>=a)return d();b=b[0];a=g.isNumber(b)&&0<b?Math.log(a)/Math.log(b):Math.log(a);if(isNaN(a)||!isFinite(a))return d();d(a)}};k.String={"":function(a,b,d){b=parseFloat(b[0],10);if(isNaN(b))return d();var e=a.length;0>b&&(b=e+b);if(0!==b%1||0>b||b>=e)return d();d(a[b])},size:function(a,b,d){d(a.length)},strip:function(a,b,d){for(var e="",c;b.length;)c=b.shift(),g.isString(c)&&(e+=c);0===e.length&&(e=" \n\r\t");b=-1;for(c=a.length;b<c&&-1!==e.indexOf(a.charAt(++b)););for(;0<=c&&-1!==e.indexOf(a.charAt(--c)););d(a.slice(b,c+1))},slice:function(a,b,d){var c=b[0],b=b[1],f=a.length;g.isNumber(c)||(c=0);0>c&&(c=f+c);0>c&&(c=0);c<f?(g.isNumber(b)||(b=0),0===b&&(b=f-c),0>b&&(b=f-c+b),0>=b?d(""):d(a.substr(c,b))):d("")},test:function(a,b,d){b=b[0];d(g.isString(b)&&null!==a.match(b))},match:function(a,b,d){b=b[0];if(!g.isString(b))return d(!1);a=a.match(b);if(g.isNull(a))return d(!1);d(Array.prototype.slice.call(a,0))},toLowerCase:function(a,b,d){d(a.toLowerCase())},toUpperCase:function(a,b,d){d(a.toUpperCase())},split:function(a,b,d){b=b[0];d(a.split(g.isString(b)?b:""))},charCodeAt:function(a,b,d){b=parseFloat(b[0],10);if(isNaN(b))return d();var c=a.length;0>b&&(b=c+b);if(0!==b%1||0>b||b>=c)return d();d(a.charCodeAt(b))},toNumber:function(a,b,d){g.isNumeric(a)?d(parseFloat(a,10)):d()}};k.Map={"":function(a,b,d){d(a.get(b[0]))},size:function(a,b,d){d(a.length())},join:function(a,b,d){d(a.join(b[0]))},keys:function(a,b,d){d(a.keys())},values:function(a,b,d){d(a.values())},hasKey:function(a,b,d){d(a.hasKey(b[0]))},remove:function(a,b,d){for(var c=a.clone();b.length;)a=b.shift(),c.remove(a);d(c)},slice:function(a,b,d){var c=b[0],b=b[1],a=a.clone();a.slice(c,b);d(a)},toJSON:function(a,b,d){d(JSON.stringify(a.toObject()))}};k.Global={clientType:ab,userAgent:gb,baseURI:function(a,b,d){d(this.getBaseURI())},resolveURI:function(a,b,d){d(g.uri.resolve(b[0],b[1]))},isMap:function(a,b,d){d(!0)},uniqueId:function(a,b,d){d(g.uniqueId())},loadJSON:function(a,b,d){var a=b.shift(),c=!g.isBoolean(b[0])&&b.shift(),f=g.isBoolean(b[0])&&b[0],b=this.getBaseURI();Q(a,b,function(a){if(!g.isString(a))return a=q(a),d(a);f&&(a=a.replace(/^\s*[$A-Z_][0-9A-Z_$]*\(\s*/i,""),a=a.replace(/\s*\);?\s*$/,""));try{a=JSON.parse(a),a=q(a),d(a)}catch(b){d()}},c,f)},loadText:function(a,b,d){var a=b[0],b=b[1],c=this.getBaseURI();Q(a,c,function(a){d(g.isString(a)?a:void 0)},b)},include:function(a,b,d){var a=b[0],c=b[1],b=this.getBaseURI();Q(a,b,function(a,b){try{return a=k(a,b),a.render(d,q(c)),a}catch(g){d()}})},rand:function(a,b,d){a=parseFloat(b[0]);b=parseFloat(b[1]);if(!g.isNumber(a)||0!==a%1)a=0;if(!g.isNumber(b)||0!==b%1)b=Math.pow(2,32)-1;d(Math.floor(Math.random()*(b-a+1))+a)},min:function(a,b,d){for(var a=b.length,c=void 0,f=0;f<a;f++)if(g.isNumber(b[f])&&(g.isUndefined(c)||b[f]<c))c=b[f];d(c)},max:function(a,b,d){for(var a=b.length,c=void 0,f=0;f<a;f++)if(g.isNumber(b[f])&&(g.isUndefined(c)||b[f]>c))c=b[f];d(c)},range:function(a,b,d){var a=[],c=parseFloat(b[0]),b=parseFloat(b[1]);if(!g.isNumber(c)||!g.isNumber(b)||0!==c%1||0!==b%1)return d();if(c>b)for(;c>=b;c-=1)a.push(c);else if(c<b)for(;c<=b;c+=1)a.push(c);else a.push(c);d(a)},dayOfWeek:function(a,b,d){var a=parseFloat(b[0]),c=parseFloat(b[1]),b=parseFloat(b[2]);if(!g.isNumber(a)||!g.isNumber(c)||!g.isNumber(b)||0!==a%1||0!==c%1||0!==b%1)return d();var f=new Date(a,c-=1,b);f.getFullYear()==a&&f.getMonth()==c&&f.getDate()==b?(b=f.getDay(),d(b?b:7)):d()},daysInMonth:function(a,b,d){a=parseFloat(b[0]);b=parseFloat(b[1]);if(!g.isNumber(a)||!g.isNumber(b)||0!==a%1||0!==b%1||1>b||12<b)return d();d((new Date(a,b,0)).getDate())}};k.load=function(a,b,d){var c=b.toUrl(a),c=g.uri.resolve(c,window.location.href);Xa(c,function(a,b){if("application/json"===b)try{a=JSON.parse(a)}catch(f){}d(k(a,c))},null)};k.setURIResolver=function(a){ia=g.isFunction(a)?a:null};return k},function(){return this}.call(null));